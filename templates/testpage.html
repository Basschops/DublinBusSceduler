<!DOCTYPE html>
<html>
<head>
<title>BUSy</title>

  {% load static %}

  <link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script type="text/javascript" src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <link rel="stylesheet" type="text/css" href="{% static 'CSS/global_style.css' %}" />
  <link rel="stylesheet" type="text/css" href="{% static 'CSS/response_style.css' %}" />
</head>
<body>

<!-- navigation bar -->
<nav class="navbar navbar-fixed-top" role="navigation">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Your Persona</span> <!--for visually impaired-->
        <span class="glyphicon glyphicon-user"></span>
      </button>
      <a href="/" class="navbar-brand">BUSy</a>
    </div>

    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="/onthego">On The Go</a></li>
        <li><a href="/theplanner">The Planner</a></li>
        <li><a href="/tourist">Tourist</a></li>
        <li class="divider"></li>
        <li><a href="#">What are personas?</a></li>
      </ul>
    </div>
  </div>
</nav>

<!-- main content will be inserted between the templating tags below -->

<div class="jumbotron text-center">
  <div class="container">
    <div class="row">
      <div class="col-sm-12">
        <p>TESTING PAGE</p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-4" style="background-color:white;">
        <p>Your current location: </p>
      </div>
      <div id="error_message" class="col-sm-4" style="background-color:white;">
        <p>Lorem impsum</p>
      </div>
        <div class="col-sm-4" style="background-color:white;">
        <div id="map_test" style="width:100%; height:400px;">
          <!-- google maps go here -->
        </div>
      </div>
    </div>
  </div>
</div>

<!-- footer -->
<footer class="page-footer blue1">
  <div class="container-fluid text-center" style="padding-bottom:auto;">
    <div class="row">
      <div class="col-sm-6">
        <h5 class="text-uppercase">BUSy</h5>
        <p>Produced by T3DB.</p>
      </div>
      <div class="col-sm-6">
        <h5 class="text-uppercase">Links</h5>
        <ul class="list-unstyled">
          <li><a href="#">About</a></li>
          <li><a href="#">Privacy Policy</a></li>
          <li><a href="#">Terms and Conditions</a></li>
          <li><a href="#">FAQs</a></li>
        </ul>
      </div>
    </div>
  </div>
  <div class="footer-copyright text-center blue2">
    Â© 2018 Copyright: <a href="#">BUSy Team</a>
  </div>
</footer>



<!-- map scrips -->
<script>
  'use strict';

var map;

//Loads the map
function initMap(){
    var mapDiv = document.getElementById("map_test");
    var mapOptions = {
        center: new google.maps.LatLng(53.3498, -6.2603),
        zoom: 11
    };

    map = new google.maps.Map(mapDiv, mapOptions);
}


var markers = [];

//Makes a marker for a stop and adds onlick functionality
function addMarkers(latlong, infowindow, stopid, fullname, routes){
    var marker = new google.maps.Marker({
        position: latlong,
        title: "Bus Stop No. "+stopid,
        draggable: false,
        map: map
    });

    google.maps.event.addListener(marker, 'click', function(content){
        infowindow.setContent("<b>Bus Stop No: </b>"+stopid
                            +"<br><br>"
                            +"<b>Name:</b> "+fullname
                            +"<br><br>"
                            +"<b>Routes serving this stop:</b>"
                            +"<br><br>"+routes
                            +"<br><br>"
                            +"<button type=\"button\" id=\"from_"+stopid+"\" onclick=\"fromButton(this)\">From "+stopid+"</button>"
                            +"<br><br>"
                            +"<button type=\"button\" id=\"to_"+stopid+"\" onclick=\"toButton(this)\">To "+stopid+"</button>");
        infowindow.open(map, marker);
    });

    markers.push(marker);
}

//Responds to onclick event when from button is clicked on a marker
function fromButton(element){
    console.log(element.id.slice(5));
    console.log(element.innerHTML);

    //$( "#from" ).value = element.id.slice(5);
    document.getElementById('from').value = element.id.slice(5);
}

//Responds to onclick event when to button is clicked on a marker
function toButton(element){
    console.log(element.id.slice(3));
    console.log(element.innerHTML);

    //document.getElementById('to').value = element.id.slice(3);
}

//Populate the map with the markers
$( window ).on( "load", function() {
    console.log( "Page ready!!" );

    var infowindow = new google.maps.InfoWindow();

    var errorMSG = document.getElementById("error_message");

    if (navigator.geolocation) {
        console.log("Got location");
        navigator.geolocation.getCurrentPosition(showPosition);
    } else { 
        errorMSG.innerHTML = "Geolocation is not supported by this browser.";
    }

    function showPosition(position) {
        addMarkers(new google.maps.LatLng(position.coords.latitude, position.coords.longitude), infowindow, 5, "testName", [5,6,7,8,8])
        errorMSG.innerHTML = "Latitude: " + position.coords.latitude + 
        "<br>Longitude: " + position.coords.longitude;
    }

  //addMarkers(new google.maps.LatLng(53.3498, -6.2603), infowindow, 5, "testName", [5,6,7,8,8]);

    //console.log(markers[0]);
});
</script>
<script src="{% static 'JS/lodash.js '%}"></script>
<!-- <script src="{% static 'JS/map.js' %}"></script> -->
<script src="{% static 'JS/autocomplete.js' %}"></script>
<script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js"></script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCXmxcpjGKrWHVNpa0s865Eq69p9s1PsHg&callback=initMap" type="text/javascript"></script>
</body>
</html>
